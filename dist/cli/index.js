module.exports=function(t,e){"use strict";var s={};function __webpack_require__(e){if(s[e]){return s[e].exports}var n=s[e]={i:e,l:false,exports:{}};t[e].call(n.exports,n,n.exports,__webpack_require__);n.l=true;return n.exports}__webpack_require__.ab=__dirname+"/";function startup(){return __webpack_require__(750)}return startup()}({58:function(t){t.exports=require("readline")},82:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.synonyms={list:{}};function arrayRandom(t){return t[Math.round(Math.random()*(t.length-1))]}e.arrayRandom=arrayRandom;function cmp(t,e){if(!t.length&&!e.length)return 1;if(!t.length||!e.length)return 0;if(t===e)return 1;if(t.length===1&&e.length===1)return 0;if(t.length<2||e.length<2)return 0;let s=new Map;for(let e=0;e<t.length-1;e++){const n=t.substring(e,e+2);const i=s.has(n)?s.get(n)+1:1;s.set(n,i)}let n=0;for(let t=0;t<e.length-1;t++){const i=e.substring(t,t+2);const r=s.has(i)?s.get(i):0;if(r>0){s.set(i,r-1);n++}}return 2*n/(t.length+e.length-2)>.8}function text1(t){return t.trim().toLowerCase().replace(/^[\w\d]/gm,"").replace("ё","е")}const s=t=>{const s=[t,...e.synonyms.list[t]||[]];return t=>{return s.some(e=>cmp(e,t))}};function distance2(t){return function(e){const n=e.split(" ").map(text1).filter(Boolean);const i=t.split(" ").map(text1).filter(Boolean);const r=n.map(t=>i.findIndex(s(t)));const o=r.filter(t=>t!==-1);const a=o.length;if(!a){return Infinity}const u=r.length;const c=u-a;if(c/u>.5){return Infinity}const l=i.length;const h=Math.max(l-a,0);if(h/l>.7){return Infinity}const f=o.map((t,e,s)=>{return e===0?t:t-s[e-1]-1});const p=Math.sqrt(f.reduce((t,e)=>{if(e>0&&e<3){return t}return t+Math.pow(Math.abs(e),2)},0))/a;const d=Math.pow(c,2)+p;return d}}function predictText(t,e){const s=t.map(distance2(e));if(process.env.DEBUG){console.log("[ERRORS]",Object.fromEntries(t.map((t,e)=>[t,s[e]]).filter(([,t])=>t<Infinity)))}const n=s.reduce((t,e)=>Math.min(t,e),+Infinity);if(!Number.isFinite(n)){return}const i=s.reduce((t,e,s)=>{return Math.abs(e-n)<=.1*n?[...t,s]:t},[]);return t[arrayRandom(i)]}e.predictText=predictText},419:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:true});var s;(function(t){t[t["CallCommand"]=0]="CallCommand";t[t["SetVariable"]=1]="SetVariable"})(s=e.ActionType||(e.ActionType={}))},492:function(t){"use strict";function Parse(t){t=t.slice(2);var e={};var s,n;t.forEach(function(t,i){t=t.split("=");s=t[0];if(s.indexOf("-")===0){s=s.slice(s.slice(0,2).lastIndexOf("-")+1)}n=t.length===2?parseFloat(t[1]).toString()===t[1]?+t[1]:t[1]:true;e[s]=n});return e}t.exports=Parse},575:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:true});const n=s(82);const i=s(419);const r=["Простите, но я вас не понял.","Объясните проще.","Попробуйте перефразировать.","Что вы имеете в виду?"];const o=["Ладно.","Вернемся к предыдущей теме.","Ок."];const a=["Пока","Обращайтесь!","Рад помочь.","Не болейте!","Вы знаете, где меня найти."];const u=["Мы об этом и говорим.","Да. Давайте продолжим.","Я помню. Об этом и речь.","Да-да!"];class Context{constructor(){this.questions=[];this.results=[];this.cases=[];this.state={cases:[],variables:{},callQueue:[]}}get rootQuestion(){const t=this.questions.find(t=>t.text==="main");if(!t){throw new Error("Root question not found")}return t}process(t){this.state.question=this.rootQuestion;const e=this.thread(t);if(!this.state.isKill){this.state.done=false}if(!e){return}return e.replace(/\$([a-zA-Z_0-9]+)/gm,(t,e)=>{const s=this.state.variables[e];if(s!==undefined){return s}return""})}thread(t){const e=this.child&&!this.child.state.isBreak?this.child:undefined;if(this.child){if(this.child.state.done){this.child=undefined}else{return this.child.thread(t)}}const s=this.parent?this.single(t):undefined;if(s){return s}if(this.state.done){return}const{question:i}=this.state;if(!i){return}if(this.parent&&this.state.question===this.rootQuestion){return}const c=new Context;c.parent=this;c.questions=this.questions;c.results=this.results;c.cases=this.cases;c.state.variables=this.state.variables;c.state.callQueue=this.state.callQueue;const l=c.thread(t);if(c.someRootWay()){return[n.arrayRandom(u),i.text].join("\n")}if(c.state.isKill){this.kill();return n.arrayRandom(a)}if(c.state.isBreak){this.state.done=true;this.state.isBreak=true;if(!this.parent||!this.parent.state.question){return}if(!this.parent.parent){return}return[n.arrayRandom(o),this.parent.state.question.text].join("\n\n")}if(c.state.isProcessPrevChild){const t=e&&(e.compileResults()||e.state.question&&e.state.question.text);if(t){this.child=e;return t}else if(this.parent){return i.text}}if(!l){this.child=e;const t=i.unknown.length?i.unknown:r;return n.arrayRandom(t)}this.child=c;return l}single(t){if(this.state.done){return}if(!this.state.question&&!this.state.cases.length){const t=this.rootQuestion;if(!t){return}this.redirect(t)}const{question:e,cases:s}=this.state;if(!e){this.state.done=true;return}const n=testExpression(this.state.cases,this.state.variables);const i=this.cases.filter(t=>t.question===e.name).filter(t=>!t.expression||n(t.expression));if(i.length){const s=this.predictCase(e,i,t);if(!s){return}if(e.userInput){this.state.variables[e.userInput]=s.sourceName}this.state.cases.push(s);switch(s.action){case"break":{this.state.isBreak=true;this.state.done=true;return}case"kill":{this.state.isKill=true;this.state.done=true;return}case"processPrevChild":{this.state.isProcessPrevChild=true;this.state.done=true;return}}this.redirect(this.questions.find(t=>t.name===(s.next||e.next)))}else if(e.userInput){this.state.variables[e.userInput]=t;this.redirect(this.questions.find(t=>t.name===e.next))}const r=[];while(true){const t=this.state.question;if(!t){break}r.push(t.text);const e=t.userInput||this.cases.some(e=>e.question===t.name);if(e){break}this.redirect(this.questions.find(e=>e.name===t.next))}if(!r.length&&this.state.question){r.push(this.state.question.text)}if(!this.state.question){this.state.done=true;const t=this.compileResults();if(t){r.push(t)}}if(!r.length){return}return r.join("\n")}predictCase(t,e,s){const i=e.flatMap(t=>t.positive);const r=n.predictText(i,s);if(!r){return}return e.find(t=>t.positive.includes(r))}redirect(t){this.processCurrentQuestionActions("out");this.state.question=t;this.processCurrentQuestionActions("in")}processCurrentQuestionActions(t){if(!this.state.question||!this.state.question.actions.length){return}this.processActions(this.state.question.actions.filter(e=>e.on=t))}processActions(t){const e=t.filter(t=>t.type===i.ActionType.CallCommand).map(({args:t})=>t[0]);this.state.callQueue.push(...e);t.filter(t=>t.type===i.ActionType.SetVariable).forEach(({args:[t,e]})=>{this.state.variables[t]=e})}compileResults(){const t=this.results.filter(t=>testExpression(this.state.cases,this.state.variables)(t.expression));if(!t.length){return}return t.map(t=>n.arrayRandom(t.texts)).filter((t,e,s)=>s.indexOf(t)===e).join("\n")}someRootWay(t){if(!this.parent){return}if(!t){const t=this.state.cases.find(t=>t.question===this.rootQuestion.name);return this.parent.someRootWay(t)}return this.state.cases.includes(t)||this.parent.someRootWay(t)}kill(){this.state.isKill=true;this.state.done=true;if(this.parent){this.parent.kill()}}}e.Context=Context;function testExpression(t,e){return function test(s){const{t:n}=s;switch(n){case"var":{const{name:n}=s;return Boolean(e[n])||Boolean(t.find(t=>`${t.question}.${t.name}`===n))}case"not":{const{a:t}=s;return!test(t)}case"and":{const{a:t,b:e}=s;return test(t)&&test(e)}case"or":{const{a:t,b:e}=s;return test(t)||test(e)}}}}},662:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.argv=s(492)(process.argv)},669:function(t){t.exports=require("util")},747:function(t){t.exports=require("fs")},750:function(t,e,s){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:true});const i=n(s(58));const r=n(s(669));const o=s(662);const a=s(816);const u=s(747);const c=a.createContext();if(typeof o.argv.vars==="string"){c.state.variables={...JSON.parse(u.readFileSync(o.argv.vars,"utf8"))}}const l=i.default.createInterface({input:process.stdin,output:process.stdout});(async function(){while(!c.state.done){const t=await new Promise(t=>l.question("> ",t));const e=c.process(t);if(process.env.DEBUG){console.log("[STATE]",r.default.inspect(c.state,false,100,true))}console.log(e||"{EMPTY_RESPONSE}");if(c.state.callQueue.length){console.log("[CALLS]",c.state.callQueue.splice(0).join(", "))}}})().finally(()=>process.exit())},816:function(t,e,s){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:true});const i=n(s(747));const r=n(s(669));const o=s(662);const a=s(575);const u=s(82);if(o.argv.debug){process.env.DEBUG="1"}if(o.argv.synonyms!==undefined){u.synonyms.list=JSON.parse(i.default.readFileSync(typeof o.argv.synonyms==="string"?o.argv.synonyms:"synonyms.json","utf-8"));console.log("Synonyms loaded:",Object.keys(u.synonyms.list).length)}function createContext(){const t=typeof o.argv.config==="string"?o.argv.config:"config.json";const e=JSON.parse(i.default.readFileSync(t,"utf-8"));const s=new a.Context;s.questions.push(...e.questions);s.cases.push(...e.cases);s.results.push(...e.results);if(process.env.DEBUG){console.log("[CONTEXT]",r.default.inspect(s,false,100,true))}return s}e.createContext=createContext}});